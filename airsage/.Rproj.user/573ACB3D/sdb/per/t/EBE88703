{
    "collab_server" : "",
    "contents" : "# Title: Get Census ACS data via Census API \n\n# Description: \n#    Gets user specified data (table_field) \n#       for specified set (acs or sf1) \n#        for specified state\n#        for specified county\n#        at the tract level\n\n# Ex: List of required tables for household disaggregation model\n        # Size model: \n#   Table: B01001 - SEX BY AGE\n#     Population <- B01001_001E   # _<n> - field number in the dataset, E - Estimate, M- Marinal Error \n\n#   Table: B08202 - HOUSEHOLD SIZE BY NUMBER OF WORKERS IN HOUSEHOLD\n#     HH         <- B08202_001E   \n#     HH_SIZE1   <- B08202_006E\n#     HH_SIZE2   <- B08202_009E\n#     HH_SIZE3   <- B08202_013E\n#     HH_SIZE4P  <- B08202_018E\n\n# Notes:\n# Required package: rjson  \n# Limitations: To get data by tract, the query requires one State & one County and \n#              using a wild card or list will return an error\n\n# Author: Amar Sarvepalli (sarvepalli@pbworld.com, 01-24-2013)\n\n#-------------------------------------------------------------------------------------------------\n# Load library\n  library(rjson)\n\n# Build query\n# to test paste in browser: http://api.census.gov/data/2011/acs5?key=e2e7a5b05c688346094ae9a76cc92473137f1589&get=B08202_001E,NAME&for=tract:*&in=state:37+county:87\n\n# Census \n  devKey     <- \"e2e7a5b05c688346094ae9a76cc92473137f1589\"       # developer key\n  census_URL <- \"http://api.census.gov/data\"                     # main url\n  year       <- \"2011\"                                           # acs year\n  dataSet    <- \"acs5\"                                           # acs or sf1\n  state_id   <- \"37\"                                             # state                                             \n  county_id  <- \" \"                                              # county: the API handles only one county at a time   \n  tract_id   <- \"*\"                                              # either \"*\" to get all or \"specify number\"                                \n\n# Household tables\n  hhs_ACSNames  <- c(\"Population\",\"HH\", \"HH_SIZE1\",\"HH_SIZE2\",\"HH_SIZE3\",\"HH_SIZE4P\")\n  hhs_ACSTables <- c(\"B01001_001E\", \"B08202_001E\", \"B08202_006E\", \"B08202_009E\", \"B08202_013E\" ,\"B08202_018E\")  \n\n# Function to get the data from the URL and convert it to table format\n  getURLData <- function(url) { \n     # Get data from URL\n     y <- fromJSON(,url, method = \"C\", unexpected.escape = \"error\")\n     # Convert JSON array to dataframe\n     tab <- as.data.frame(do.call(rbind,lapply(y, function(x) unlist(x))))\n     # Note the first row is header\n     colnames(tab) <- as.character(unlist(tab[1,]))\n     # Move the data_field to last\n     tab <- tab[2:nrow(tab),c(2:ncol(tab),1)]\n  }\n\n\n# Get a list of counties in NC State\n  counties_in_NC <- \"E:/Asheville/SurveyPilot/Counties_in_NC.csv\"\n  county_list <- read.csv(counties_in_NC)\n  counties <- sprintf(\"%03d\",unique(county_list$FIPS.Code))\n\n# Loop by counties\n  # counties <- c(\"21\", \"87\", \"89\", \"115\", \"175\")\n  \n  for(co in 1:length(counties)){\n    county_id = counties[co]\n    \n    # Loop by tables  \n    for(t in 1:length(hhs_ACSTables)){\n        \n       tableNumber <- hhs_ACSTables[t]\n       url_query <- paste(census_URL,\"/\",year,\"/\",dataSet,\"?key=\",devKey,\"&get=\",tableNumber,\",NAME&for=tract:\",tract_id,\"&in=state:\",state_id,\"+county:\",county_id,sep=\"\")\n    \n       # Get data from URL (format JSON array)\n       tab <- getURLData(url_query)\n       \n       # Add fields from the table\n       ifelse(t == 1, all_tables <- tab, all_tables <- cbind(all_tables,tab[ncol(tab)]))\n       \n       # Write to csv file\n       if (t==length(hhs_ACSTables)) {\n         # Rename columns with user specified fields\n         colnames(all_tables) <- c(colnames(all_tables[,1:(ncol(all_tables)-length(hhs_ACSTables))]),hhs_ACSNames)\n       }\n    }\n    \n    # Join tables for all counties\n    ifelse(co==1, all_counties <- all_tables, all_counties <- rbind(all_counties, all_tables))\n    \n    # Write output\n    if(co== length(counites)) {\n       write.csv(all_counties,\"E:\\\\Asheville\\\\subModels\\\\hh_sub_data.csv\", row.names= FALSE)\n    }\n  } # end county\n",
    "created" : 1475771871686.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "641364320",
    "id" : "EBE88703",
    "lastKnownWriteTime" : 1377723159,
    "last_content_update" : 1377723159,
    "path" : "~/Desktop/github/Flagler/GetCensusData_API.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}